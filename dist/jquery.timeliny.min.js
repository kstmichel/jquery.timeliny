(function(d,c,a,e){function b(i,l){var g=i;var D=d(i);var m=D.children();l=d.extend({},d.fn.timeliny.defaults,l);function o(){p("onInit");if(l.hideBlankYears===false){z()}A();r();E();h();C();q();x();j();w();k()}function u(){m.detach().sort(function(G,F){return l.order==="asc"?d(G).data("year")-d(F).data("year"):d(F).data("year")-d(G).data("year")});D.append(m)}function k(){D.addClass("loaded");var G=d(".timeliny-timeline");d(G).addClass("year-view");d(".originalFrame").removeClass("originalFrame").addClass("visibleEvent");var I=D.find("."+l.className+"-timeblock.active").first().attr("data-year");var F=D.find("."+l.className+"-timeblock.active").first().attr("data-month");var H=D.find("."+l.className+"-timeblock.active").first().attr("data-week");console.log("curr mark",I,F,H);p("afterLoad",[I,F,H]);x()}var f=true;var n=false;var B=false;var v=false;function A(){console.debug("_granularity ENTER");var F=d(".granularity-years");var H=d(".granularity-months");var I=d(".granularity-weeks");var G=d(".granularity-days");d(F).click(function(){var O=d(".timeliny-timeline");var J=d(".timeliny-timeblock");var L=d(".timeliny-dot");var P=d(".inactive-month");var M=d(".inactive-week");var N=d(".timeliny-timeblock:not(.active)");var K=d(".timeliny-timeblock:not(.inactive-year)");console.debug("years button clicked ~!~!~!~!~!~!~!~!~!~!~!~");n=false;B=false;f=true;d(O).addClass("year-view");d(O).removeClass("month-view weeks-view days-view");d(J).removeClass(" only_event initial_events extra_events");d(L).removeClass("clicked");d(H).attr("disabled",false);d(I).attr("disabled",false);d(P).remove();d(M).remove();d(N).show();d(K).addClass("visibleEvent");z();x();C()});d(H).click(function(){var P=d(".timeliny-timeline");var J=d(".timeliny-timeblock");var L=d(".timeliny-timeblock.active").attr("data-year");var O=d(".extra_events");var K=d(".timeliny-dot");var M=d(".inactive-week");var N=d(".timeliny-timeblock:not(.active)");f=false;B=false;n=true;console.debug("months button clicked ~!~!~!~!~!~!~!~!~!~!~!~");d(F).attr("disabled",false);d(I).attr("disabled",false);d(P).removeClass("year-view weeks-view days-view");d(P).addClass("month-view");d(O).removeClass("active");d(J).removeClass(" only_event initial_events extra_events");d(K).remove();d(N).hide();d(M).remove();d(J).each(function(){if(d(this).attr("data-year")!==L){d(this).removeClass("visibleEvent");d(this).hide();console.log("remove visible from hidden years",L)}else{if(d(this).attr("data-month")==d(".visibleEvent").attr("data-month")){console.log("remove extra months");d(this).last().hide()}else{d(this).addClass("visibleEvent")}}});z();x();C()});d(I).click(function(){var L=d(".timeliny-timeline");var J=d(".timeliny-timeblock");var O=d(".timeliny-timeblock.active");var N=d(O).attr("data-year");var K=d(O).attr("data-month");var M=d(".inactive-month");console.log("weeks btn clicked ~!~!~!~!~!~!~!~!~!~!~!~");f=false;n=false;B=true;d(F).attr("disabled",false);d(H).attr("disabled",false);d(I).attr("disabled",true);d(L).removeClass("year-view month-view days-view");d(L).addClass("weeks-view");d(J).removeClass(" only_event initial_events extra_events");d(M).remove();d(J).each(function(){var Q=d(this).attr("data-year");var P=d(this).attr("data-month");if(d(P)==K){d(this).removeClass("visibleEvent")}if(d(P)!==K){d(this).hide()}if(d(Q)==N&&d(P)==K){d(this).addClass("visibleEvent")}});z();x();C()});d(G).click(function(){var N=d(".timeliny-timeline");var K=d(".timeliny-timeblock");var Q=d(".timeliny-timeblock.active");var P=d(Q).attr("data-year");var M=d(Q).attr("data-month");var O=d(Q).attr("data-week");var L=d(".inactive-week");var J=d(".timeliny-timeblock[data-year="+P+"][data-month="+M+"][data-week="+O+"]");console.log("days btn clicked ~!~!~!~!~!~!~!~!~!~!~!~");f=false;n=false;B=false;v=true;d(F).attr("disabled",false);d(H).attr("disabled",false);d(I).attr("disabled",false);d(G).attr("disabled",true);d(N).removeClass("year-view month-view weeks-view");d(N).addClass("days-view");d(K).removeClass(" only_event initial_events extra_events");d(L).remove();d(J).addClass("visibleEvent");console.log("actives",P,M,O);z();x();C()})}function z(){var J=d(".granularity-years");var W=d(".granularity-months");var aF=d(".granularity-weeks");var au=d(".granularity-days");var M=d(".timeliny-timeline");var O=d(".timeliny-timeblock");var aH=d(".timeliny-dot");var az=d(".timeliny-timeblock.active");var X=d(az).attr("data-year");var V=d(az).attr("data-month");var S=d(az).attr("data-month");var aj=d(az).attr("data-day");var ak;var I;var aw;var ae;var aE;var am;var ag;var ar;var T;var ay;var av;var aa;var aD;var ao;var ac;if(f===true){var ah=2008;var P=2020;aw=ah;ae=P;ak=0;am=[];av=d(".visibleEvent");ak=0;d(J).attr("disabled",true);console.debug("Setting up years datalog");d(av).each(function(){if(ak===0){am.push(d(this).attr("data-year"));ak++}if(d(this).attr("data-year")!==am[ak-1]){am.push(d(this).attr("data-year"));ak++}});ak=0;console.debug("eventsLog for Years",am,aw,ae)}if(n===true){var ax="01";var af=12;aw=ax;ae=af;av=d(".timeliny-timeblock[data-year="+X+"]");ak=0;X=d(az).attr("data-year");am=[];am.length=0;d(W).attr("disabled",true);console.debug("Setting up months datalog");console.log("clear log",am);var G=d(az).attr("data-month");d(av).each(function(){var aI=d(this).attr("data-month");if(d.inArray(aI,am)==-1){am.push(aI);ak++}});ak=0;console.debug("eventsLog for Months",am)}if(B===true){ak=0;av=d(".timeliny-timeblock[data-year="+X+"][data-month="+V+"]");console.debug("Setting up weeks datalog");d(aF).attr("disabled",true);am=[];am.length=0;console.log("clear log",am,X,V);var H=d(az).attr("data-week");an=new Date(aj+"-"+V+"-"+X);var U=aj;var K=new Date(an.getFullYear(),an.getMonth(),an.getDate()-an.getDay()-7);var Z=new Date(an.getFullYear(),an.getMonth(),an.getDate()-an.getDay()+6);ab=K.getDay();al=Z.getDay();F=X;aG=Number(V).toString();var Y=V--;console.debug("figre this out",V,aG,Y,F,aw,ae);L=[];aq=[];for(var aB=0;aB<=new Date(F,V,0).getDate();aB++){aC=new Date(F,V,aB);if(aC.getDay()==6){console.log("date",aC);L.push(("0"+aB).slice(-2))}else{if(aC.getDay()==0){console.log("date",aC);aq.push(("0"+aB).slice(-2))}}}var ad=0;var N=d(aq).length;aw=ad;ae=N;console.debug("SUNDAYS",aq,aG,F,aw,ae);d(av).each(function(){var aI=d(this).attr("data-week");console.log("weeks log");if(d.inArray(aI,am)==-1){console.log("push weeks to log");am.push(aI);ak++}});ak=0;console.debug("eventsLog for Weeks",am)}if(v===true){var ab;var al;ak=0;X=d(az).attr("data-year");V=d(az).attr("data-month");S=d(az).attr("data-week");aj=d(az).attr("data-day");ay=d(".visibleEvent");av=d(".timeliny-timeblock[data-year="+X+"][data-month="+V+"][data-week="+S+"]");aa=d(".timeliny-timeblock:not([data-year="+X+"][data-month="+V+"][data-week="+S+"])");console.debug("Setting up days datalog");var ai=function(aJ,aI){return new Date(aI,aJ,0).getDate()};var an=new Date(aj+"-"+V+"-"+X);U=aj;K=new Date(an.getFullYear(),an.getMonth(),an.getDate()-an.getDay()-7);Z=new Date(an.getFullYear(),an.getMonth(),an.getDate()-an.getDay()+6);ab=K.getDay();al=Z.getDay();var F=X;var aG=V;var L=[];var aq=[];for(var aB=0;aB<=new Date(F,aG,0).getDate();aB++){var aC=new Date(F,aG,aB);if(aC.getDay()==6){L.push(aC)}else{if(aC.getDay()==0){aq.push(aC)}}}console.log("DAYS SUNDAYS + SAT",aq,L);console.debug("Sunday","Current Day",U,"Saturday");aw=ab;ae=al;d(au).attr("disabled",true);am=[];am.length=0;console.log("clear log",am,az,X,V,S,aj);d(ay).removeClass("visibleEvent");d(aa).hide();d(av).each(function(){d(this).addClass("visibleEvent");var aI=d(this).attr("data-day");console.log("days log");if(d.inArray(aI,am)==-1){console.log("push day to log");am.push(aI);ak++}});ak=0;console.debug("eventsLog for Days",am)}if(l.order==="asc"){console.debug("ascending list---STATS",aw,ae);for(var at=aw;at<ae+1;at++){X=d(az).attr("data-year");V=d(az).attr("data-month");if(f===true){console.log("Adding yearsView ghost frames");ao=at;I="timeliny-year";ag=m.parent().parent().find("[data-year="+(at-1)+"]").not(aH);ar=m.parent().parent().find("[data-year="+(at+1)+"]").not(aH);aE=m.parent().parent().find("[data-year="+at+"]").not(aH);T='<div data-year="'+ao+'" data-month="01" class="inactive inactive-year">'+ao+" ghost frame</div>";m=D.children()}if(n===true){console.log("Adding monthsView ghost frames");I="timeliny-month";ao=("0"+at).slice(-2);ac=("0"+(at-1)).slice(-2);console.log("newY",ao,"Y",at);aD='[data-year="'+X+'"]';ag=m.parent().parent().find("[data-year="+X+"][data-month="+ac+"]").not(aH);aE=m.parent().parent().find("[data-year="+X+"][data-month="+ao+"]").not(aH);console.log("what is newY - 1?",(ao-1));T='<div data-year="'+X+'" data-month="'+ao+'" class="inactive inactive-month">'+ao+" ghost frame</div>"}if(B===true){console.debug("Adding weeksView ghost frames");I="timeliny-week";ao=("0"+at).slice(-2);ac=("0"+(at-1)).slice(-2);console.log("newY",ao,"Y",at);aD='[data-year="'+X+'"][data-month="'+V+'"]';ag=m.parent().parent().find("[data-year="+X+"][data-month="+V+"][data-week="+ac+"]").not(aH);aE=m.parent().parent().find("[data-year="+X+"][data-month="+V+"][data-week="+ao+"]").not(aH);T='<div data-year="'+X+'" data-month="'+V+'" data-week="'+aq[at]+'" class="inactive inactive-week">'+ao+" ghost frame</div>"}if(v===true){console.debug("Adding daysView ghost frames");I="timeliny-day";ao=("0"+at).slice(-2);ac=("0"+(at-1)).slice(-2);console.log("newY",ao,"Y",at);aD='[data-year="'+X+'"][data-month="'+V+'"][data-week="'+S+'"]';ag=m.parent().parent().find("[data-year="+X+"][data-month="+V+"][data-week="+S+"][data-day="+ac+"]").not(aH);aE=m.parent().parent().find("[data-year="+X+"][data-month="+V+"][data-week="+S+"][data-day="+ao+"]").not(aH);T='<div data-year="'+X+'" data-month="'+V+'" data-week="'+S+'" data-day="'+ao+'" class="inactive inactive-day">'+ao+" ghost frame</div>"}console.log("dataMonth",V);if(d(aE).length<=0){console.log("not detecting event...");if(ao>aw){console.debug("y is > than firstFrame",ao,aw);d(ag).last().after(T)}else{console.debug("y is firstFrame",ao,aw);console.debug("PLACEMENT...");if(f==true){console.debug("Years configuration");m.first().before(T)}else{console.debug("not years configuration");d(M).find(aD).first().not(aH).before(T)}}}else{console.debug("event exists...",ao);d(aE).show();if(ao==am[ak]){d(aE).addClass("visibleEvent");console.debug("y Equal to EventLog, print no frame",ao,"===",am[ak],ak);console.debug("Mark extra events");if(d(aE).length>=2){d(aE).first().addClass("initial_events");d(aE).not(":first").addClass("extra_events")}if(d(aE).length===1){d(aE).first().addClass("only_event").removeClass("initial_events")}if(d(aE).hasClass("only_event")||d(aE).hasClass("initial_events")){ak++;console.debug("not Only Event: add to index:",ak,am[ak])}else{console.debug("has only_event")}var R=new Date();var Q=R.getFullYear();var F=d(aE).attr("data-year");console.debug("TODAY",R,"TODAY YEAR",F,Q);if(F==Q){d(aE).addClass("active")}}}}}else{for(var ao=aw;ao>=ae;ao--){if(d(aE).length<=0){if(ao<ah){d(ar).after(T)}else{m.first().before(T)}}}}var ap=d(".timeliny-timeblock.extra_events.active");var aA=d(ap).attr("data-year");console.debug("timeline cleanup");d(".initial_events[data-year="+aA+"]").addClass("active");d(ap).removeClass("active");E()}function r(){return D.addClass(l.className).children().wrapAll(l.wrapper).wrapAll('<div class="'+l.className+'-timeline"></div>')}function h(){var F=D.css("padding-top").replace("px","")*0.8;D.find("."+l.className+"-timeline").css("width",""+(m.length*F)+"px");D.find("."+l.className+"-timeliny-timeblock").css("width",""+F+"px")}function E(){console.debug("initialize dots...");m=d(".timeliny-timeline").children();m.each(function(){var M=d(this).html();var J=d(this).attr("data-year");var L=d(this).attr("data-month");var I=d(this).attr("data-week");var H=d(this).attr("data-day");var G=d(this).find(".timeliny-dot");var F;var K=J+L+I+H;if(d(M).length){console.debug("text has length");F='<a href="#'+K+'" class="'+l.className+'-dot" data-year="'+J+'" data-month="'+L+'" data-week="'+I+'" data-day="'+H+'" data-text="  "></a>'}else{console.debug("text has NO length");F='<a href="#'+K+'" class="'+l.className+'-dot" data-year="'+J+'" data-month="'+L+'" data-week="'+I+'" data-day="'+H+'" data-text="'+M+'"></a>'}d(this).addClass(""+l.className+"-timeblock").html(F)})}function q(){D.append('<div class="'+l.className+'-vertical-line"></div>')}function x(K){var F=D.find("."+l.className+"-vertical-line").position().left;var H=D.find("."+l.className+"-timeblock.active").position().left;var G=D.find("."+l.className+"-timeblock.active ."+l.className+"-dot").width()/2;var J=H-F;var I;if(J>0){I="-"+(Math.abs(J)+G+1)+""}else{I="+"+(Math.abs(J)-G-1)+""}D.find("."+l.className+"-timeline").animate({left:I},l.animationSpeed,function(){if(typeof K!="undefined"){if(K==="click"){var P=D.find("."+l.className+"-timeblock.active").first().attr("data-year");var L=D.find("."+l.className+"-timeblock.active").first().attr("data-month");var N=D.find("."+l.className+"-timeblock.active").first().attr("data-week");var O=D.find("."+l.className+"-timeblock.active").first().attr("data-day");var M=P+L+N+O;console.debug("CLICKEDDDDDDDDD","years",f,"months",n,"weeks",B,"current",M);p("afterChange",[M]);console.log(p,[M])}else{if(K==="resize"){p("afterResize")}}}})}function C(){m.parent().find("."+l.className+"-timeblock:not(.inactive) ."+l.className+"-dot").on("click",function(M){M.preventDefault();var J=d(this).parent().parent().find("."+l.className+"-timeblock.active");var Q=d(this).parent().parent().find("."+l.className+"-timeblock.active").attr("data-year");var G=d(this).parent().parent().find("."+l.className+"-timeblock.active").attr("data-month");var I=d(this).parent().parent().find("."+l.className+"-timeblock.active").attr("data-week");var O=d(this).parent().parent().find("."+l.className+"-timeblock.active").attr("data-day");var P=d(this).attr("data-year");var L=d(this).attr("data-month");var H=d(this).attr("data-week");var N=d(this).attr("data-day");d(this).toggleClass("clicked");var K=Q+G+I+O;var F=P+L+H+N;if(K!=F){p("onLeave",[K,F]);d(J).removeClass("active");d(this).closest("."+l.className+"-timeblock").addClass("active")}x("click");return false})}function j(){function F(I,G){var H;return function(){var J=arguments;var K=this;clearTimeout(H);H=setTimeout(function(){I.apply(K,J)},G)}}d(c).on("resize.timeliny",F(function(){x("resize")},350))}function w(){var J=null,I=0,K=0;function G(L){J=L;K=I-J.offsetLeft}function F(L){I=a.all?c.event.clientX:L.pageX;if(J!==null){J.style.left=(I-K)+"px"}}function H(){if(J){var L=D.find("."+l.className+"-vertical-line").offset().left;var M=null;var N=1e+23;D.find("."+l.className+"-dot[data-year="+M+"]").trigger("click");J=null}}D.first().on("mousedown",function(){G(D.find("."+l.className+"-timeline")[0]);return false});d(a).on("mousemove.timeliny",function(L){F(L)});d(a).on("mouseup.timeliny",function(){H()})}function t(G){var F=D.find("."+l.className+"-timeblock[data-year="+G+"]:not(.inactive) ."+l.className+"-dot").first();if(F.length>0){F.trigger("click")}}function s(F,G){if(G){l[F]=G}else{return l[F]}}function y(){D.each(function(){var G=this;var F=d(this);d(c).off("resize.timeliny");F.find("."+l.className+"-timeblock:not(.inactive) ."+l.className+"-dot").off("click");d(a).off("mousemove.timeliny");d(a).off("mouseup.timeliny");F.first().off("mousedown");F.remove();p("onDestroy");F.removeData("plugin_timeliny")})}function p(G,F){if(l[G]!==e){l[G].apply(g,F)}}o();return{option:s,destroy:y,goToYear:t}}d.fn.timeliny=function(h){console.log(h);if(typeof arguments[0]==="string"){var f=arguments[0];var g=Array.prototype.slice.call(arguments,1);var i;this.each(function(){if(d.data(this,"plugin_timeliny")&&typeof d.data(this,"plugin_timeliny")[f]==="function"){i=d.data(this,"plugin_timeliny")[f].apply(this,g)}else{throw new Error("Method "+f+" does not exist on jQuery.timeliny")}});if(i!==e){return i}else{return this}}else{if(typeof h==="object"||!h){return this.each(function(){if(!d.data(this,"plugin_timeliny")){d.data(this,"plugin_timeliny",new b(this,h))}})}}};d.fn.timeliny.defaults={order:"asc",className:"timeliny",wrapper:'<div class="timeliny-wrapper"></div>',boundaries:2,animationSpeed:250,hideBlankYears:false,onInit:function(){},onDestroy:function(){},afterLoad:function(h,f,g){},onLeave:function(g,f){},afterChange:function(f){},afterResize:function(){}}})(jQuery,window,document);